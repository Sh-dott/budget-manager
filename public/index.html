<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ניהול תקציב משותף</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app">
        <!-- Background Effects -->
        <div class="bg-gradient"></div>
        <div class="bg-blur bg-blur-1"></div>
        <div class="bg-blur bg-blur-2"></div>
        <div class="bg-blur bg-blur-3"></div>

        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">₪</div>
                    <div class="logo-text">
                        <span class="logo-title">תקציב משותף</span>
                        <span class="logo-subtitle">ניהול חכם</span>
                    </div>
                </div>
            </div>

            <ul class="nav-list">
                <li class="nav-item active" data-view="dashboard">
                    <span class="nav-icon">📊</span>
                    <span>סקירה כללית</span>
                </li>
                <li class="nav-item" data-view="transactions">
                    <span class="nav-icon">💳</span>
                    <span>תנועות</span>
                </li>
                <li class="nav-item" data-view="analytics">
                    <span class="nav-icon">📈</span>
                    <span>ניתוח והשוואות</span>
                </li>
                <li class="nav-item" data-view="categories">
                    <span class="nav-icon">🏷️</span>
                    <span>קטגוריות</span>
                </li>
                <li class="nav-item" data-view="shopping">
                    <span class="nav-icon">🛒</span>
                    <span>רשימות קניות</span>
                </li>
                <li class="nav-item" data-view="settings">
                    <span class="nav-icon">⚙️</span>
                    <span>הגדרות</span>
                </li>
            </ul>

            <div class="sidebar-footer">
                <div class="couple-badge">
                    <span class="heart-icon">💑</span>
                    <span>ביחד מנהלים טוב יותר</span>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main">
            <!-- Top Bar -->
            <header class="topbar">
                <div class="month-nav">
                    <button class="month-btn" id="prevMonth">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                    <div class="current-month" id="currentMonth">ינואר 2026</div>
                    <button class="month-btn" id="nextMonth">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                </div>
                <button class="add-btn" id="addTransactionBtn">
                    <span class="add-icon">+</span>
                    <span>הוסף תנועה</span>
                </button>
            </header>

            <!-- Dashboard View -->
            <section class="view active" id="dashboard-view">
                <!-- AI Insights Widgets Row -->
                <div class="ai-widgets-row">
                    <!-- Daily Tips Widget -->
                    <div class="ai-widget daily-tips-widget">
                        <div class="widget-header">
                            <h4>💡 טיפ חיסכון יומי</h4>
                            <button class="widget-refresh-btn" onclick="refreshDailyTips()" title="רענן">🔄</button>
                        </div>
                        <div id="dailyTipContent" class="widget-content">
                            <div class="widget-loading">טוען...</div>
                        </div>
                    </div>

                    <!-- Anomaly Detection Widget -->
                    <div class="ai-widget anomaly-widget">
                        <div class="widget-header">
                            <h4>⚠️ התראות חריגה</h4>
                        </div>
                        <div id="anomalyContent" class="widget-content">
                            <div class="widget-loading">בודק...</div>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card balance-card">
                        <div class="stat-icon">💰</div>
                        <div class="stat-content">
                            <span class="stat-label">יתרה חודשית</span>
                            <span class="stat-value" id="balance">₪0</span>
                        </div>
                        <div class="stat-wave"></div>
                    </div>
                    <div class="stat-card income-card">
                        <div class="stat-icon">📈</div>
                        <div class="stat-content">
                            <span class="stat-label">הכנסות</span>
                            <span class="stat-value" id="income">₪0</span>
                        </div>
                        <div class="stat-wave"></div>
                    </div>
                    <div class="stat-card expense-card">
                        <div class="stat-icon">📉</div>
                        <div class="stat-content">
                            <span class="stat-label">הוצאות</span>
                            <span class="stat-value" id="expenses">₪0</span>
                        </div>
                        <div class="stat-wave"></div>
                    </div>
                    <div class="stat-card savings-card">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-content">
                            <span class="stat-label">אחוז חיסכון</span>
                            <span class="stat-value" id="savingsRate">0%</span>
                        </div>
                        <div class="stat-wave"></div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="charts-row">
                    <div class="chart-card">
                        <div class="card-header">
                            <h3>תזרים יומי</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="dailyChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card pie-chart-card">
                        <div class="card-header">
                            <h3>התפלגות הוצאות</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="expensesPieChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- AI Insights Card -->
                <div class="card ai-insights-card">
                    <div class="card-header">
                        <h3>🤖 תובנות AI</h3>
                        <button class="insights-btn" id="getInsightsBtn" onclick="getAIInsights()">
                            <span>נתח עכשיו</span>
                        </button>
                    </div>
                    <div id="aiInsightsContent" class="ai-insights-content">
                        <div class="insights-placeholder">
                            <span class="placeholder-icon">💡</span>
                            <p>לחץ על "נתח עכשיו" לקבלת תובנות והמלצות מותאמות אישית</p>
                        </div>
                    </div>
                </div>

                <!-- Budget Alerts -->
                <div id="budgetAlerts" class="budget-alerts-container"></div>

                <!-- Budget Progress -->
                <div class="card budget-card">
                    <div class="card-header">
                        <h3>מעקב תקציב</h3>
                        <a href="#" class="view-all" data-nav="settings">הגדרות</a>
                    </div>
                    <div id="budgetProgress" class="budget-progress-list"></div>
                </div>

                <!-- Recent Transactions -->
                <div class="card recent-card">
                    <div class="card-header">
                        <h3>תנועות אחרונות</h3>
                        <a href="#" class="view-all" data-nav="transactions">הצג הכל</a>
                    </div>
                    <div class="transactions-list" id="recentTransactions"></div>
                </div>
            </section>

            <!-- Transactions View -->
            <section class="view" id="transactions-view">
                <div class="card">
                    <div class="card-header">
                        <h3>כל התנועות</h3>
                        <div class="filters">
                            <select id="typeFilter" class="filter-select">
                                <option value="all">הכל</option>
                                <option value="income">הכנסות</option>
                                <option value="expense">הוצאות</option>
                            </select>
                            <select id="categoryFilter" class="filter-select">
                                <option value="all">כל הקטגוריות</option>
                            </select>
                        </div>
                    </div>
                    <!-- Search Bar -->
                    <div class="search-bar">
                        <div class="search-input-wrapper">
                            <span class="search-icon">🔍</span>
                            <input type="text" id="searchInput" placeholder="חיפוש לפי תיאור, קטגוריה או אדם..." class="search-input">
                        </div>
                        <div class="search-filters">
                            <div class="amount-filter">
                                <input type="number" id="searchMinAmount" placeholder="סכום מינימלי" class="amount-filter-input">
                                <span class="amount-separator">-</span>
                                <input type="number" id="searchMaxAmount" placeholder="סכום מקסימלי" class="amount-filter-input">
                            </div>
                        </div>
                    </div>
                    <div class="transactions-list" id="allTransactions"></div>
                </div>
            </section>

            <!-- Analytics View -->
            <section class="view" id="analytics-view">
                <div class="analytics-grid">
                    <div class="chart-card">
                        <div class="card-header">
                            <h3>מגמת 6 חודשים</h3>
                        </div>
                        <div class="chart-container large">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="card-header">
                            <h3>השוואה חודשית</h3>
                        </div>
                        <div class="chart-container large">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Per-Person Analytics -->
                <div class="analytics-grid">
                    <div class="chart-card">
                        <div class="card-header">
                            <h3>הוצאות לפי אדם</h3>
                        </div>
                        <div class="chart-container large">
                            <canvas id="personChart"></canvas>
                        </div>
                    </div>
                    <div class="card person-stats-card">
                        <div class="card-header">
                            <h3>סטטיסטיקות אישיות</h3>
                        </div>
                        <div id="personStatsCards" class="person-stats-grid"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>סיכום חודשי</h3>
                    </div>
                    <div class="summary-table" id="summaryTable"></div>
                </div>
            </section>

            <!-- Settings View -->
            <section class="view" id="settings-view">
                <div class="card">
                    <div class="card-header">
                        <h3>תמונות פרופיל</h3>
                        <p class="card-subtitle">לחץ על התמונה לבחירת תמונה מהגלריה</p>
                    </div>
                    <div class="avatars-grid">
                        <div class="avatar-setting">
                            <label for="shaiAvatarInput" class="avatar-upload-label">
                                <div class="avatar-preview" id="shaiAvatar">
                                    <span>S</span>
                                </div>
                                <div class="avatar-edit-icon">📷</div>
                            </label>
                            <h4>Shai</h4>
                            <input type="file" id="shaiAvatarInput" accept="image/*" hidden>
                        </div>
                        <div class="avatar-setting">
                            <label for="galAvatarInput" class="avatar-upload-label">
                                <div class="avatar-preview" id="galAvatar">
                                    <span>G</span>
                                </div>
                                <div class="avatar-edit-icon">📷</div>
                            </label>
                            <h4>Gal</h4>
                            <input type="file" id="galAvatarInput" accept="image/*" hidden>
                        </div>
                        <div class="avatar-setting">
                            <label for="chubbyAvatarInput" class="avatar-upload-label">
                                <div class="avatar-preview" id="chubbyAvatar">
                                    <span>C</span>
                                </div>
                                <div class="avatar-edit-icon">📷</div>
                            </label>
                            <h4>Chubby</h4>
                            <input type="file" id="chubbyAvatarInput" accept="image/*" hidden>
                        </div>
                    </div>
                </div>

                <!-- Budget Settings -->
                <div class="card">
                    <div class="card-header">
                        <h3>הגדרות תקציב</h3>
                        <p class="card-subtitle">הגדר תקציב חודשי לכל קטגוריה</p>
                    </div>
                    <div id="budgetSettings" class="budget-settings-grid"></div>
                </div>

                <!-- AI Budget Recommendations -->
                <div class="card ai-recommendations-card">
                    <div class="card-header">
                        <h3>🤖 המלצות תקציב חכמות</h3>
                        <button class="insights-btn" onclick="loadBudgetRecommendations()">חשב המלצות</button>
                    </div>
                    <div id="budgetRecommendations" class="recommendations-list">
                        <div class="recommendations-placeholder">
                            <span class="placeholder-icon">📊</span>
                            <p>לחץ על "חשב המלצות" לקבלת הצעות תקציב מבוססות היסטוריה</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Shopping Lists View -->
            <section class="view" id="shopping-view">
                <div class="shopping-header">
                    <h2>🛒 רשימות קניות</h2>
                    <button class="add-btn" onclick="createNewShoppingList()">
                        <span class="add-icon">+</span>
                        <span>רשימה חדשה</span>
                    </button>
                </div>

                <!-- Active Shopping Lists -->
                <div id="shoppingLists" class="shopping-lists-container">
                    <div class="empty-state">
                        <div class="empty-state-icon">🛍️</div>
                        <p>אין רשימות קניות</p>
                        <button class="add-category-btn" onclick="createNewShoppingList()">צור רשימה ראשונה</button>
                    </div>
                </div>

                <!-- Price Search -->
                <div class="card price-search-card">
                    <div class="card-header">
                        <h3>🔍 השוואת מחירים</h3>
                    </div>

                    <!-- Category Menu -->
                    <div class="category-menu">
                        <button class="category-btn" onclick="searchByCategory('מוצרי חלב')">
                            <span class="cat-icon">🥛</span>
                            <span>מוצרי חלב</span>
                        </button>
                        <button class="category-btn" onclick="searchByCategory('לחם ומאפים')">
                            <span class="cat-icon">🍞</span>
                            <span>לחם ומאפים</span>
                        </button>
                        <button class="category-btn" onclick="searchByCategory('פירות וירקות')">
                            <span class="cat-icon">🥬</span>
                            <span>פירות וירקות</span>
                        </button>
                        <button class="category-btn" onclick="searchByCategory('בשר ודגים')">
                            <span class="cat-icon">🥩</span>
                            <span>בשר ודגים</span>
                        </button>
                        <button class="category-btn" onclick="searchByCategory('שתייה')">
                            <span class="cat-icon">🥤</span>
                            <span>שתייה</span>
                        </button>
                        <button class="category-btn" onclick="searchByCategory('חטיפים')">
                            <span class="cat-icon">🍿</span>
                            <span>חטיפים</span>
                        </button>
                        <button class="category-btn" onclick="searchByCategory('מוצרי ניקיון')">
                            <span class="cat-icon">🧹</span>
                            <span>ניקיון</span>
                        </button>
                        <button class="category-btn" onclick="searchByCategory('תינוקות')">
                            <span class="cat-icon">🍼</span>
                            <span>תינוקות</span>
                        </button>
                    </div>

                    <!-- Search Bar -->
                    <div class="price-search-wrapper">
                        <input type="text" id="priceSearchInput" placeholder="חפש מוצר ספציפי..." class="search-input"
                            onkeypress="if(event.key==='Enter') searchPrices()">
                        <button class="insights-btn" onclick="searchPrices()">חפש</button>
                    </div>

                    <!-- Popular Products in Category -->
                    <div id="categoryProducts" class="category-products" style="display: none;"></div>

                    <!-- Advanced Filters (shown after search) -->
                    <div id="priceFiltersContainer" class="price-filters-container" style="display: none;">
                        <div class="filters-header">
                            <h4>סינון תוצאות</h4>
                            <button class="clear-filters-btn" onclick="clearPriceFilters()">נקה הכל</button>
                        </div>

                        <!-- Chain Filter -->
                        <div class="filter-group">
                            <label class="filter-label">סנן לפי רשת</label>
                            <div class="chain-filter-grid" id="chainFilterGrid">
                                <label class="chain-filter-item">
                                    <input type="checkbox" value="שופרסל" onchange="applyPriceFilters()">
                                    <span class="chain-checkbox">🟢 שופרסל</span>
                                </label>
                                <label class="chain-filter-item">
                                    <input type="checkbox" value="רמי לוי" onchange="applyPriceFilters()">
                                    <span class="chain-checkbox">🔵 רמי לוי</span>
                                </label>
                                <label class="chain-filter-item">
                                    <input type="checkbox" value="ויקטורי" onchange="applyPriceFilters()">
                                    <span class="chain-checkbox">🟡 ויקטורי</span>
                                </label>
                                <label class="chain-filter-item">
                                    <input type="checkbox" value="אושר עד" onchange="applyPriceFilters()">
                                    <span class="chain-checkbox">🟠 אושר עד</span>
                                </label>
                                <label class="chain-filter-item">
                                    <input type="checkbox" value="יינות ביתן" onchange="applyPriceFilters()">
                                    <span class="chain-checkbox">🟣 יינות ביתן</span>
                                </label>
                                <label class="chain-filter-item">
                                    <input type="checkbox" value="מגה" onchange="applyPriceFilters()">
                                    <span class="chain-checkbox">🔴 מגה</span>
                                </label>
                                <label class="chain-filter-item">
                                    <input type="checkbox" value="חצי חינם" onchange="applyPriceFilters()">
                                    <span class="chain-checkbox">🟤 חצי חינם</span>
                                </label>
                                <label class="chain-filter-item">
                                    <input type="checkbox" value="טיב טעם" onchange="applyPriceFilters()">
                                    <span class="chain-checkbox">⚫ טיב טעם</span>
                                </label>
                                <label class="chain-filter-item">
                                    <input type="checkbox" value="יוחננוף" onchange="applyPriceFilters()">
                                    <span class="chain-checkbox">🟩 יוחננוף</span>
                                </label>
                            </div>
                        </div>

                        <!-- Sort Options -->
                        <div class="filter-group">
                            <label class="filter-label">מיין לפי</label>
                            <div class="sort-options">
                                <button class="sort-btn active" data-sort="price-asc" onclick="setSortOption('price-asc')">
                                    מחיר ⬆️
                                </button>
                                <button class="sort-btn" data-sort="price-desc" onclick="setSortOption('price-desc')">
                                    מחיר ⬇️
                                </button>
                                <button class="sort-btn" data-sort="name" onclick="setSortOption('name')">
                                    שם א-ת
                                </button>
                            </div>
                        </div>

                        <!-- View Options -->
                        <div class="filter-group">
                            <label class="filter-label">תצוגה</label>
                            <div class="view-options">
                                <button class="view-btn active" data-view="cards" onclick="setViewOption('cards')">
                                    🃏 כרטיסים
                                </button>
                                <button class="view-btn" data-view="compact" onclick="setViewOption('compact')">
                                    📋 קומפקטי
                                </button>
                                <button class="view-btn" data-view="table" onclick="setViewOption('table')">
                                    📊 טבלה
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Search Results -->
                    <div id="priceSearchResults" class="price-search-results"></div>
                </div>

                <!-- Deal Alerts Banner -->
                <div id="dealAlertsBanner" class="deal-alerts-banner" style="display: none;">
                    <div class="deal-alert-header">
                        <span>🏷️ מבצעים שאולי יעניינו אותך</span>
                    </div>
                    <div id="dealAlertsList" class="deal-alerts-list"></div>
                </div>
            </section>

            <!-- Categories View -->
            <section class="view" id="categories-view">
                <div class="categories-grid">
                    <div class="card category-card">
                        <div class="card-header">
                            <h3>קטגוריות הכנסה</h3>
                        </div>
                        <div class="category-tags" id="incomeCategories"></div>
                        <div class="add-category-form">
                            <input type="text" id="newIncomeCategory" placeholder="שם קטגוריה חדשה..." class="category-input">
                            <button class="add-category-btn" onclick="addCategory('income')">הוסף</button>
                        </div>
                    </div>
                    <div class="card category-card">
                        <div class="card-header">
                            <h3>קטגוריות הוצאה</h3>
                        </div>
                        <div class="category-tags" id="expenseCategories"></div>
                        <div class="add-category-form">
                            <input type="text" id="newExpenseCategory" placeholder="שם קטגוריה חדשה..." class="category-input">
                            <button class="add-category-btn" onclick="addCategory('expense')">הוסף</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Mobile Bottom Navigation -->
        <nav class="mobile-nav">
            <button class="mobile-nav-item active" data-view="dashboard">
                <span class="mobile-nav-icon">📊</span>
                <span>סקירה</span>
            </button>
            <button class="mobile-nav-item" data-view="transactions">
                <span class="mobile-nav-icon">💳</span>
                <span>תנועות</span>
            </button>
            <button class="mobile-nav-item add-fab" id="mobileAddBtn">
                <span class="mobile-nav-icon">+</span>
            </button>
            <button class="mobile-nav-item" data-view="shopping">
                <span class="mobile-nav-icon">🛒</span>
                <span>קניות</span>
            </button>
            <button class="mobile-nav-item" data-view="settings">
                <span class="mobile-nav-icon">⚙️</span>
                <span>הגדרות</span>
            </button>
        </nav>
    </div>

    <!-- Add Transaction Modal -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <div class="modal-header">
                <h2>תנועה חדשה</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <form id="transactionForm">
                <!-- Receipt Scanner -->
                <div class="receipt-scanner">
                    <input type="file" id="receiptInput" accept="image/*" capture="environment" hidden>
                    <button type="button" class="scan-receipt-btn" onclick="triggerReceiptScan()">
                        <span>📷</span>
                        <span>סרוק קבלה</span>
                    </button>
                    <div id="receiptScanStatus" class="scan-status" style="display: none;"></div>
                </div>

                <div class="type-selector">
                    <button type="button" class="type-btn expense active" data-type="expense">
                        <span class="type-icon">📉</span>
                        <span>הוצאה</span>
                    </button>
                    <button type="button" class="type-btn income" data-type="income">
                        <span class="type-icon">📈</span>
                        <span>הכנסה</span>
                    </button>
                </div>

                <div class="form-group">
                    <label>סכום</label>
                    <div class="amount-input-wrapper">
                        <span class="currency-symbol">₪</span>
                        <input type="number" id="amount" step="0.01" min="0" required placeholder="0.00">
                    </div>
                </div>

                <div class="form-group">
                    <label>קטגוריה</label>
                    <select id="category" required></select>
                </div>

                <div class="form-group">
                    <label>תיאור</label>
                    <input type="text" id="description" placeholder="תיאור התנועה...">
                </div>

                <div class="form-group">
                    <label>תאריך</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-group recurring-group">
                    <label class="toggle-label">
                        <span class="toggle-text">תנועה קבועה (חוזרת כל חודש)</span>
                        <div class="toggle-switch">
                            <input type="checkbox" id="recurringToggle">
                            <span class="toggle-slider"></span>
                        </div>
                    </label>
                    <p class="recurring-hint">תנועות קבועות יופיעו אוטומטית בכל החודשים הבאים</p>
                </div>

                <div class="form-group">
                    <label>מי הוסיף?</label>
                    <div class="person-selector">
                        <button type="button" class="person-btn active" data-person="Shai">
                            <img src="" alt="" class="person-avatar" id="shaiAvatarBtn">
                            <span>Shai</span>
                        </button>
                        <button type="button" class="person-btn" data-person="Gal">
                            <img src="" alt="" class="person-avatar" id="galAvatarBtn">
                            <span>Gal</span>
                        </button>
                        <button type="button" class="person-btn" data-person="Chubby">
                            <img src="" alt="" class="person-avatar" id="chubbyAvatarBtn">
                            <span>Chubby</span>
                        </button>
                        <button type="button" class="person-btn" data-person="משותף">
                            <span>👫</span>
                            <span>משותף</span>
                        </button>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancelBtn">ביטול</button>
                    <button type="submit" class="btn-primary">שמור</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Tesseract.js for OCR (lazy loaded) -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js" defer></script>
    <script src="app.js"></script>
</body>
</html>
